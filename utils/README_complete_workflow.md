# é€è§†å˜æ¢æ•°æ®å¢å¼ºå®Œæ•´å·¥ä½œæµç¨‹

## ğŸ“– æ¦‚è¿°

æœ¬å·¥ä½œæµç¨‹ä¸ºå¤šæ¨¡æ€è§†é¢‘ç‰¹å¾åŒ¹é…ä»»åŠ¡æä¾›å®Œæ•´çš„é€è§†å˜æ¢æ•°æ®å¢å¼ºè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ•°æ®å¢å¼ºã€æ ‡ç­¾ç”Ÿæˆå’ŒåŒ¹é…å‡†ç¡®åº¦è¯„ä¼°ã€‚

## ğŸ¯ å·¥ä½œæµç¨‹æ¶æ„

```mermaid
graph TB
    A[åŸå§‹RGBè§†é¢‘] --> B[é€è§†å˜æ¢å¢å¼º]
    C[å¤šæ¨¡æ€è§†é¢‘] --> D[é€è§†å˜æ¢å¢å¼º]
    B --> E[RGB+é€è§†å˜æ¢çŸ©é˜µ]
    D --> F[å¤šæ¨¡æ€+é€è§†å˜æ¢çŸ©é˜µ]
    E --> G[ç”ŸæˆRGBå•ä½çŸ©é˜µ]
    F --> H[è¿è¡ŒåŒ¹é…ç®—æ³•]
    G --> H
    H --> I[åŒ¹é…ç»“æœ]
    I --> J[è®¡ç®—ç›¸å¯¹å˜æ¢æ ‡ç­¾]
    J --> K[åŒ¹é…å‡†ç¡®åº¦è¯„ä¼°]
```

## ğŸ› ï¸ è„šæœ¬å·¥å…·

### 1. `perspective_augmentation.py` - é€è§†å˜æ¢æ•°æ®å¢å¼º
**ç”¨é€”**: å¯¹å¤šæ¨¡æ€è§†é¢‘è¿›è¡Œé€è§†å˜æ¢å¢å¼º
```bash
python utils/perspective_augmentation.py \
    --input_dir /mnt/mDisk2/APIDIS/mm \
    --output_dir /mnt/mDisk2/APIDIS_P/mm \
    --max_shift 0.05 \
    --seed 42
```

**è¾“å‡º**:
- é€è§†å˜æ¢åçš„è§†é¢‘æ–‡ä»¶ï¼ˆä¿æŒåŸå§‹æ–‡ä»¶åï¼‰
- `*_perspective_matrix.npy`: é€è§†å˜æ¢çŸ©é˜µ
- `*_perspective_params.json`: å˜æ¢å‚æ•°è®°å½•

### 2. `generate_identity_matrices.py` - RGBå•ä½çŸ©é˜µç”Ÿæˆ
**ç”¨é€”**: ä¸ºRGBè§†é¢‘ç”Ÿæˆå¯¹åº”çš„å•ä½çŸ©é˜µæ–‡ä»¶ï¼Œç»Ÿä¸€å¤„ç†æµç¨‹
```bash
python utils/generate_identity_matrices.py \
    --input_dir /mnt/mDisk2/APIDIS/mp4 \
    --output_dir /mnt/mDisk2/APIDIS_P/mp4
```

**è¾“å‡º**:
- `*_perspective_matrix.npy`: 3Ã—3å•ä½çŸ©é˜µ
- `*_perspective_params.json`: çŸ©é˜µå‚æ•°ä¿¡æ¯

### 3. `calculate_relative_transforms.py` - ç›¸å¯¹å˜æ¢æ ‡ç­¾è®¡ç®—
**ç”¨é€”**: è®¡ç®—åŒ¹é…æ¨¡æ€å¯¹ä¹‹é—´çš„ç›¸å¯¹é€è§†å˜æ¢å…³ç³»ä½œä¸ºæ ‡ç­¾
```bash
python utils/calculate_relative_transforms.py \
    --rgb_dir /mnt/mDisk2/APIDIS_P/mp4 \
    --mm_dir /mnt/mDisk2/APIDIS_P/mm \
    --output_dir /mnt/mDisk2/APIDIS_P/MultiModal_Output
```

**è¾“å‡º**:
- `relative_transform_matrix.npy`: ç›¸å¯¹é€è§†å˜æ¢çŸ©é˜µï¼ˆæ ‡ç­¾ï¼‰
- `relative_transform_params.json`: ç›¸å¯¹å˜æ¢å‚æ•°å’Œå…ƒæ•°æ®

## ğŸ“ ç›®å½•ç»“æ„

### è¾“å…¥ç›®å½•ç»“æ„
```
/mnt/mDisk2/APIDIS/
â”œâ”€â”€ mp4/                    # åŸå§‹RGBè§†é¢‘
â”‚   â”œâ”€â”€ A1.mp4
â”‚   â”œâ”€â”€ A2.mp4
â”‚   â””â”€â”€ ...
â””â”€â”€ mm/                     # åŸå§‹å¤šæ¨¡æ€æ•°æ®
    â”œâ”€â”€ A1/
    â”‚   â”œâ”€â”€ A1_frequency_domain.mp4
    â”‚   â”œâ”€â”€ A1_motion_thermal.mp4
    â”‚   â””â”€â”€ ...
    â””â”€â”€ A2/
        â”œâ”€â”€ A2_frequency_domain.mp4
        â””â”€â”€ ...
```

### å¤„ç†åç›®å½•ç»“æ„
```
/mnt/mDisk2/APIDIS_P/
â”œâ”€â”€ mp4/                    # RGB + å•ä½çŸ©é˜µ
â”‚   â”œâ”€â”€ A1.mp4
â”‚   â”œâ”€â”€ A1_perspective_matrix.npy
â”‚   â”œâ”€â”€ A1_perspective_params.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ mm/                     # é€è§†å˜æ¢åçš„å¤šæ¨¡æ€æ•°æ®
â”‚   â”œâ”€â”€ A1/
â”‚   â”‚   â”œâ”€â”€ A1_frequency_domain.mp4
â”‚   â”‚   â”œâ”€â”€ A1_frequency_domain_perspective_matrix.npy
â”‚   â”‚   â”œâ”€â”€ A1_frequency_domain_perspective_params.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â””â”€â”€ MultiModal_Output/      # åŒ¹é…ç»“æœ + ç›¸å¯¹å˜æ¢æ ‡ç­¾
    â””â”€â”€ A1/
        â””â”€â”€ FreqDomain_vs_MotionThermal/
            â”œâ”€â”€ MatchResult/
            â”œâ”€â”€ relative_transform_matrix.npy
            â””â”€â”€ relative_transform_params.json
```

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### æ­¥éª¤1: æ•°æ®å¢å¼º
```bash
# 1. å¯¹å¤šæ¨¡æ€è§†é¢‘è¿›è¡Œé€è§†å˜æ¢
python utils/perspective_augmentation.py \
    --input_dir /mnt/mDisk2/APIDIS/mm \
    --output_dir /mnt/mDisk2/APIDIS_P/mm \
    --max_shift 0.05 \
    --seed 42

# 2. ä¸ºRGBè§†é¢‘ç”Ÿæˆå•ä½çŸ©é˜µ
python utils/generate_identity_matrices.py \
    --input_dir /mnt/mDisk2/APIDIS/mp4 \
    --output_dir /mnt/mDisk2/APIDIS_P/mp4
```

### æ­¥éª¤2: è¿è¡ŒåŒ¹é…ç®—æ³•
```bash
# ä½¿ç”¨ç°æœ‰çš„æ‰¹å¤„ç†è„šæœ¬ï¼Œä½†è·¯å¾„æŒ‡å‘å¢å¼ºåçš„æ•°æ®
./multimodal_batch.sh
# æ³¨æ„ï¼šéœ€è¦ä¿®æ”¹è„šæœ¬ä¸­çš„è·¯å¾„ä¸º /mnt/mDisk2/APIDIS_P/
```

### æ­¥éª¤3: ç”ŸæˆåŒ¹é…æ ‡ç­¾
```bash
# è®¡ç®—ç›¸å¯¹é€è§†å˜æ¢å…³ç³»ä½œä¸ºæ ‡ç­¾
python utils/calculate_relative_transforms.py \
    --rgb_dir /mnt/mDisk2/APIDIS_P/mp4 \
    --mm_dir /mnt/mDisk2/APIDIS_P/mm \
    --output_dir /mnt/mDisk2/APIDIS_P/MultiModal_Output
```

### æ­¥éª¤4: åŒ¹é…å‡†ç¡®åº¦è¯„ä¼°
```bash
# ä½¿ç”¨ç°æœ‰çš„åˆ†æè„šæœ¬ï¼ŒåŒ…å«ç›¸å¯¹å˜æ¢æ ‡ç­¾
python utils/analyze_match_results.py \
    --output_dir /mnt/mDisk2/APIDIS_P/MultiModal_Output
```

## ğŸ§® æ•°å­¦åŸç†

### é€è§†å˜æ¢å…³ç³»
å‡è®¾åŸå§‹è§†è§’ä¸º Iï¼Œä¸¤ä¸ªæ¨¡æ€ç»è¿‡é€è§†å˜æ¢åï¼š
- `modality1 = I Ã— H1`
- `modality2 = I Ã— H2`

### ç›¸å¯¹å˜æ¢è®¡ç®—
è¦å°† modality1 å¯¹é½åˆ° modality2ï¼Œç›¸å¯¹å˜æ¢å…³ç³»ä¸ºï¼š
```
H_relative = H2 Ã— H1^(-1)
```

è¿™æ ·ï¼š
```
modality1 Ã— H_relative = (I Ã— H1) Ã— (H2 Ã— H1^(-1)) = I Ã— H2 = modality2
```

### åŒ¹é…å‡†ç¡®åº¦è¯„ä¼°
åœ¨è¯„ä¼°åŒ¹é…å‡†ç¡®åº¦æ—¶ï¼Œä½¿ç”¨ `H_relative` ä½œä¸ºçœŸå€¼æ ‡ç­¾ï¼š
1. å°†åŒ¹é…ç‚¹é€šè¿‡ `H_relative` è¿›è¡Œå˜æ¢
2. è®¡ç®—å˜æ¢åçš„ç‚¹ä¸å®é™…åŒ¹é…ç‚¹ä¹‹é—´çš„è¯¯å·®
3. ç»Ÿè®¡åœ¨ä¸åŒè¯¯å·®é˜ˆå€¼ä¸‹çš„å‡†ç¡®ç‡

## âš™ï¸ é…ç½®å‚æ•°

### é€è§†å˜æ¢å‚æ•°
- `max_shift`: æœ€å¤§åç§»æ¯”ä¾‹ï¼ˆæ¨è 0.03-0.08ï¼‰
- `seed`: éšæœºç§å­ï¼ˆç¡®ä¿å¯é‡ç°ï¼‰

### åŒ¹é…ç®—æ³•å‚æ•°
- ä¿æŒç°æœ‰çš„åŒ¹é…ç®—æ³•å‚æ•°ä¸å˜
- ä½¿ç”¨å¢å¼ºåçš„æ•°æ®ä½œä¸ºè¾“å…¥

### è¯„ä¼°å‚æ•°
- ä½¿ç”¨ç›¸å¯¹å˜æ¢çŸ©é˜µä½œä¸ºçœŸå€¼æ ‡ç­¾
- æ”¯æŒå¤šç§è¯¯å·®é˜ˆå€¼è¯„ä¼°

## ğŸ“Š è¯„ä¼°æŒ‡æ ‡

### æ–°å¢æŒ‡æ ‡
- **å˜æ¢è·ç¦»**: ç›¸å¯¹å˜æ¢çŸ©é˜µä¸å•ä½çŸ©é˜µçš„FrobeniusèŒƒæ•°
- **æ•°å€¼ç¨³å®šæ€§**: çŸ©é˜µæ¡ä»¶æ•°
- **å˜æ¢ç±»å‹**: çŸ©é˜µè¡Œåˆ—å¼å€¼

### ä¼ ç»ŸæŒ‡æ ‡
- åƒç´ çº§å‡†ç¡®ç‡ï¼ˆå¤šä¸ªé˜ˆå€¼ï¼‰
- åŒ¹é…ç‚¹ä¿ç•™ç‡
- RANSACå†…ç‚¹æ¯”ä¾‹

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **çŸ©é˜µæ–‡ä»¶æœªæ‰¾åˆ°**
   - æ£€æŸ¥æ–‡ä»¶å‘½åæ ¼å¼
   - ç¡®è®¤é€è§†å˜æ¢æ­¥éª¤å·²å®Œæˆ
   - éªŒè¯è·¯å¾„é…ç½®

2. **çŸ©é˜µè®¡ç®—é”™è¯¯**
   - æ£€æŸ¥çŸ©é˜µæ˜¯å¦ä¸ºå¥‡å¼‚çŸ©é˜µ
   - éªŒè¯çŸ©é˜µæ¡ä»¶æ•°
   - ç¡®è®¤è¾“å…¥çŸ©é˜µæ ¼å¼æ­£ç¡®

3. **åŒ¹é…ç»“æœç›®å½•ç»“æ„é”™è¯¯**
   - ç¡®è®¤åŒ¹é…ç®—æ³•å·²è¿è¡Œ
   - æ£€æŸ¥ç›®å½•å‘½åæ ¼å¼
   - éªŒè¯æ¨¡æ€åç§°æ˜ å°„

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨ç¤ºä¾‹è„šæœ¬æµ‹è¯•**
   ```bash
   python utils/example_perspective_usage.py
   python utils/example_relative_transforms_usage.py
   ```

2. **æ£€æŸ¥ä¸­é—´ç»“æœ**
   - éªŒè¯é€è§†å˜æ¢çŸ©é˜µçš„åˆç†æ€§
   - æ£€æŸ¥ç›¸å¯¹å˜æ¢çŸ©é˜µçš„æ•°å€¼ç¨³å®šæ€§
   - ç¡®è®¤æ–‡ä»¶è·¯å¾„å’Œå‘½åæ­£ç¡®

3. **åˆ†æ­¥éª¤è°ƒè¯•**
   - å…ˆå¤„ç†å•ä¸ªåœºæ™¯
   - é€æ­¥å¢åŠ å¤„ç†èŒƒå›´
   - å¯¹æ¯”å¤„ç†å‰åçš„ç»“æœ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é€è§†å˜æ¢æ•°æ®å¢å¼ºæ–‡æ¡£](README_perspective_augmentation.md)
- [åŒ¹é…ç»“æœåˆ†ææ–‡æ¡£](../analyze_match_results.py)
- [OpenCV é€è§†å˜æ¢æ–‡æ¡£](https://docs.opencv.org/4.x/da/d54/group__imgproc__transform.html)

## ğŸ¤ ä½¿ç”¨å»ºè®®

1. **æ•°æ®å¤‡ä»½**: åœ¨å¤„ç†å‰å¤‡ä»½åŸå§‹æ•°æ®
2. **å‚æ•°è°ƒä¼˜**: ä»å°çš„å˜æ¢å¼ºåº¦å¼€å§‹æµ‹è¯•
3. **æ‰¹é‡å¤„ç†**: ä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–æ•´ä¸ªæµç¨‹
4. **ç»“æœéªŒè¯**: å®šæœŸæ£€æŸ¥ä¸­é—´ç»“æœçš„åˆç†æ€§
5. **æ€§èƒ½ç›‘æ§**: å…³æ³¨å¤„ç†æ—¶é—´å’Œå†…å­˜ä½¿ç”¨

## ğŸ“ æ›´æ–°æ—¥å¿—

- **v1.0**: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºç¡€é€è§†å˜æ¢å¢å¼º
- **v1.1**: æ·»åŠ RGBå•ä½çŸ©é˜µç”ŸæˆåŠŸèƒ½
- **v1.2**: å®ç°ç›¸å¯¹å˜æ¢æ ‡ç­¾è®¡ç®—
- **v1.3**: å®Œå–„æ–‡æ¡£å’Œç¤ºä¾‹è„šæœ¬
